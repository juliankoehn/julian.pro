---
import Layout from "@/layouts/layout.astro";
import type { Person, WithContext } from "schema-dts"
import TechStack from "@/components/tech-stack/tech-stack.astro" // Keep just in case or remove if unused. It was used in replaced content, so I should remove it.
import SocialProof from "@/components/social-proof.astro";
import Competencies from "@/components/competencies.astro";

import PageHero from "@/sections/hero.astro"
// Hero component removed from usage
import { getSinglePage } from '@/lib/content-parser.astro';
import { sortByDate } from '@/lib/utils/sort';
import BlogPost from '@/components/blog-post.astro';
import Link from '@/components/link.astro';


const metaData = {
    title: "Julian Koehn",
    summary: "I'm a software engineer, currently working at Astro.",
    get description() {
        return `${this.title} - ${this.summary}`
    },
}

const jsonLd: WithContext<Person> = {
    "@context": "https://schema.org",
    "@type": "Person",
    name: "Julian Koehn",
    alternateName: "Julian",
    description: metaData.summary,
    email: "me@julian.pro"
}

if (Astro.site) {
  jsonLd["@id"] = `${Astro.site}#identity`
  jsonLd.url = Astro.site.toString()
}

const posts = await getSinglePage("blog")
const sortedPosts = sortByDate(posts)

const totalPages: number = Math.ceil(posts.length / 3);
const currentPosts = sortedPosts.slice(0, 3);


---
<Layout>
    <PageHero />
    <Competencies />
    
    <section class="w-full px-5vw relative py-20 border-t border-white/10">
        <div class="mx-auto max-w-8xl">
            <div class="mb-12">
                 <span class="font-sans font-semibold text-secondary text-sm uppercase tracking-widest mb-2 block">
                    Thoughts & Analysis
                </span>
                <h2 class="font-serif font-bold text-primary text-3xl lg:text-5xl">
                    Key Insights
                </h2>
                <p class="mt-4 text-lg text-gray-400 font-sans max-w-2xl">
                    Deep dives into security architecture, risk management, and the future of compliance.
                </p>
            </div>

            <div
            class="relative grid grid-cols-4 gap-x-4 md:grid-cols-8 lg:grid-cols-12 lg:gap-x-6 mx-auto max-w-8xl"
            >
            {
                currentPosts.map((post) => (
                <div class="col-span-4 mb-10 flex">
                    <BlogPost url={`/blog/${post.slug}`} title={post.data.title} date={post.data.date} image={post.data.image}
                        description={post.data.description}
                    />
                </div>
                ))
            }

            <div class="col-span-full mt-4">
                <Link href="/blog">
                    View Archive
                </Link>
            </div>
            </div>
        </div>
    </section>
</Layout>