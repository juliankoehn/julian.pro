---
import BlogListHeader from '@/components/blog-list-header.astro';
import BlogPost from "@/components/blog-post.astro";
import Pagination from '@/components/pagination.astro';
import TopicScroll from '@/components/topic-scroll.astro';
import Layout from "@/layouts/layout.astro";
import { getSinglePage } from '@/lib/content-parser.astro';
import { slugify } from '@/lib/utils/slugify';
import { sortByDate } from '@/lib/utils/sort';

const PAGE_SIZE = 9;

const posts = await getSinglePage("blog")
const sortedPosts = sortByDate(posts)

const totalPages: number = Math.ceil(posts.length / PAGE_SIZE);
const currentPosts = sortedPosts.slice(0, PAGE_SIZE);

const tags = [...new Set(posts.map((post) => post.data.topics).flat())];

const pageTitle = "Blog";
---

<Layout title={pageTitle}>
    <section class="relative pt-10 pb-20 w-full">
        <!-- Animated Aurora Background -->
        <div class="absolute inset-0 pointer-events-none">
             <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-primary/20 blur-[120px] rounded-full animate-pulse-slow"></div>
            <div class="absolute top-[20%] right-[20%] w-[30%] h-[30%] bg-blue-900/10 blur-[100px] rounded-full animate-pulse-slow" style="animation-delay: 4s;"></div>
        </div>
        <!-- Noise Texture -->
        

        <div class="w-full px-5vw mx-auto relative z-10 w-full">
            <div class="max-w-8xl mx-auto w-full">
                <div class="max-w-3xl mb-16 animate-fade-in-up mt-10">
                    <span class="font-sans font-semibold text-secondary text-sm uppercase tracking-widest mb-4 block">
                        Insights & Engineering
                    </span>
                    <h1 class="font-serif font-bold text-white text-5xl lg:text-7xl tracking-tight leading-[1.1] mb-6">
                        Engineering <br/>
                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-secondary to-white">Trust.</span>
                    </h1>
                    <p class="text-xl text-white/70 leading-relaxed font-sans max-w-2xl">
                        Deep dives into ISO 27001, SOC 2, and the future of GRC automation. Practical guides for engineers building secure systems.
                    </p>
                </div>

                <TopicScroll tags={tags} />

                <!-- Posts Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12 animate-fade-in-up" style="animation-delay: 0.2s;">
                    {
                        currentPosts.map((post) => (
                        <div class="flex flex-col group h-full">
                            <BlogPost url={`/blog/${post.slug}`} title={post.data.title} date={post.data.date} image={post.data.image}
                                description={post.data.description}
                            />
                        </div>
                        ))
                    }
                </div>
                
                 <div class="mt-20 border-t border-white/10 pt-10">
                    <Pagination
                        section={"blog"}
                        currentPage={1}
                        totalPages={totalPages}
                    />
                </div>
            </div>
        </div>
    </section>
</Layout>
